import pandas as pd
import matplotlib.pyplot as plt
import json

# توليد تقرير CSV مع رسم بياني
def generate_report(findings):
    # تحويل النتائج إلى DataFrame
    df = pd.DataFrame(findings).transpose()
    report_path = 'csrf_report.csv'
    df.to_csv(report_path, index=True)
    print(f"Report generated: {report_path}")
    
    # رسم بياني بسيط لعدد الرموز في كل ملف
    df['tokens_found'].plot(kind='bar')
    plt.title("CSRF Tokens Found in Each File")
    plt.xlabel("File")
    plt.ylabel("Tokens Found")
    plt.savefig("csrf_report.png")
    print("Report graph generated: csrf_report.png")

    # توليد تقرير JSON
    json_report_path = 'csrf_report.json'
    with open(json_report_path, 'w') as json_file:
        json.dump(findings, json_file, indent=4)
    print(f"JSON Report generated: {json_report_path}")
